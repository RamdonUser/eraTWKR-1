;대본가게
@COM620
#DIM CHARISMA
PRINTFORML 소지금:\\{MONEY}
PRINTL 「임차료는 모두\3000입니다」
$C_LOOP
PRINT [1] 전술지도서

IF ITEM:101
	PRINTFORML (%마스터가% 빌리고 있다)
ELSEIF GETBIT (FLAG:1011, 1)
	PRINTL (대출중)
ELSE
	PRINTL 　
ENDIF
PRINT [2] 조리지도서
IF ITEM:102
	PRINTFORML (%마스터가% 빌리고 있다)
ELSEIF GETBIT (FLAG:1011, 2)
	PRINTL (대출중)
ELSE
	PRINTL 　
ENDIF
PRINT [3] 사전
IF ITEM:103
	PRINTFORML (%마스터가% 빌리고 있다)
ELSEIF GETBIT (FLAG:1011, 3)
	PRINTL (대출중)
ELSE
	PRINTL 　
ENDIF
PRINT [4] 단편소설
IF ITEM:104
	PRINTFORML (%마스터가% 빌리고 있다)
ELSEIF GETBIT (FLAG:1011, 4)
	PRINTL (대출중)
ELSE
	PRINTL 　
ENDIF
PRINT [5] 연주지도서
IF ITEM:105
	PRINTFORML (%마스터가% 빌리고 있다)
ELSEIF GETBIT (FLAG:1011, 5)
	PRINTL (대출중)
ELSE
	PRINTL 　
ENDIF
PRINT [7] 생선도감
IF ITEM:107
	PRINTFORML （%마스터가% 빌리고 있다）
ELSEIF GETBIT (FLAG:1011,7)
	PRINTL （대출중）
ELSE
	PRINTL 　
ENDIF
PRINT [8] 채집가이드
IF ITEM:108
	PRINTFORML （%마스터가% 빌리고 있다）
ELSEIF GETBIT (FLAG:1011,8)
	PRINTL （대출중）
ELSE
	PRINTL 　
ENDIF
PRINT [9] 약학교본
IF ITEM:109
	PRINTFORML （%마스터가% 빌리고 있다）
ELSEIF GETBIT (FLAG:1011,9)
	PRINTL （대출중）
ELSE
	PRINTL 　
ENDIF

IF !CHARISMA
	PRINTFORML [100] 카리스마 지불
ELSE
	PRINTFORML [100] 현금지불
ENDIF
DRAWLINE
PRINTL [0] 그만둔다

$LOOP
INPUT
IF ITEM:101 || ITEM:102 || ITEM:103 || ITEM:104 || ITEM:105 || ITEM:107 || ITEM:108 || ITEM:109
	PRINTL 「2권 이상의 대출은 할 수 없습니다」
	RETURN -1
ELSEIF RESULT == 100
	IF !CHARISMA
		PRINTFORMW 「카리스마로 지불해?」
		PRINTFORMW 「그러니까……자 10 카리스마? 그리고 좋습니다……」
		IF MONEY:2 < 10
			PRINTFORMW 카리스마가 부족하다
			GOTO C_LOOP
		ENDIF
	ELSE
		PRINTFORMW 「아, 돈으로 지불해 줍니다」
	ENDIF
	PRINTFORML 
	CHARISMA = !CHARISMA
	GOTO C_LOOP
ELSE
	IF INRANGE(RESULT, 1, 9)
		IF GETBIT (FLAG:1011, RESULT)
			PRINTL 「대출중입니다」
		ELSE
			SETBIT FLAG:1011, RESULT
			IF !CHARISMA
				MONEY -= 3000
			ELSE
				MONEY:2 -= 10
			ENDIF
			ITEM:(100 + RESULT) = 1
			FLAG:대본반환기한 = 8
			TFLAG:193 = 1
			PRINTFORML %ITEMNAME:(100 + RESULT)%를 빌렸다
			RETURN 1
		ENDIF
	ELSEIF RESULT == 0
		RETURN -1
	ELSE
		GOTO LOOP
	ENDIF
ENDIF
TIME += 30

;대본소
@COM_ABLE620
;일괄관리
SIF GLOBAL_COMABLE(620)
	RETURN RESULT
IF !AT_HOME(MASTER)
	SIF CFLAG:MASTER:현재위치 != 상가거리
		RETURN 0
ELSE
	SIF CFLAG:MASTER:현재위치 != 213
		RETURN 0
ENDIF

SIF MONEY < 3000
	RETURN 0
;수면중
SIF CFLAG:수면
	RETURN 0
;시간정지중
SIF FLAG:70
	RETURN 0
RETURN 1

@BOOKLEND

FOR LOCAL,1,10
	SIF LOCAL == 6	;[그림연극]을 패스
		CONTINUE
	SIF !ITEM:(100 + LOCAL) && !RAND:3
		INVERTBIT FLAG:1011, LOCAL
NEXT
SIF FLAG:대본반환기한
	FLAG:대본반환기한 -= 1
IF FLAG:대본반환기한 == 1
	ITEM:101 = 0
	ITEM:102 = 0
	ITEM:103 = 0
	ITEM:104 = 0
	ITEM:105 = 0
	ITEM:107 = 0
	ITEM:108 = 0
	ITEM:109 = 0
	PRINTL 반환 기한이 왔으므로, 빌리고 있던 책을 돌려주었습니다.
ENDIF